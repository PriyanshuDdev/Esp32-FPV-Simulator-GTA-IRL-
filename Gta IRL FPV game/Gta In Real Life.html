<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>GTA_IRL Combined Page</title>
  <style>
    /* ===============================
       GLOBAL BASE
    =============================== */
    body, html {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Segoe UI', sans-serif;
      color: #fff;
      background: #000 url('G.jpg') center/cover no-repeat;
      overflow: hidden;
    }

    /* ===============================
       BACKGROUND VIDEO
    =============================== */
    #bg-video {
      position: fixed;
      top: 50%;
      left: 50%;
      min-width: 100%;
      min-height: 100%;
      transform: translate(-50%, -50%);
      object-fit: cover;
      z-index: 0;
      background: black;
    }

    /* ===============================
       LANDING SECTION
    =============================== */
    #landing {
      position: fixed;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding-top: 60px;
      text-align: center;
      transition: opacity 1s ease;
      z-index: 2;
      opacity: 1;
      animation: fadeIn 2s forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    #landing.fade-out {
      opacity: 0;
      pointer-events: none;
    }

    #logo {
      max-width: 400px;
      margin-bottom: 5px;
      border-radius: 20px;
      animation: logoGlow 3s infinite alternate;
    }

    @keyframes logoGlow {
      0%   { filter: drop-shadow(0 0 25px cyan); }
      50%  { filter: drop-shadow(0 0 50px purple); }
      100% { filter: drop-shadow(0 0 25px cyan); }
    }

    .glow-text {
      font-size: 14px;
      margin-top: 5px;
      text-shadow: 0 0 10px cyan, 0 0 20px purple;
      animation: glowPulse 2s infinite alternate;
    }

    @keyframes glowPulse {
      from { text-shadow: 0 0 10px cyan, 0 0 20px purple; }
      to   { text-shadow: 0 0 20px purple, 0 0 40px cyan; }
    }

    #start-btn {
      margin-top: 40px;
      padding: 14px 40px;
      font-size: 20px;
      font-weight: bold;
      border: none;
      background: linear-gradient(135deg, #00e6e6, #6a0dad);
      color: #fff;
      cursor: pointer;
      border-radius: 5px;
      transition: transform 0.2s ease;
    }

    #start-btn:hover { transform: scale(1.08); }
    #start-btn:active { transform: scale(0.95); }

    /* ===============================
       OVERLAY VIDEO
    =============================== */
    #overlay-video {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      object-fit: cover;
      z-index: 9999;
      pointer-events: none;
      opacity: 1;
      transition: opacity 0.3s ease;
    }

    /* ===============================
       MAIN PAGE
    =============================== */
    #main-page {
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      height: 100%;
      background: #050505;
      overflow: hidden;
      animation: fadeIn 1.2s forwards;
      z-index: 1;
    }

    /* Video frame */
    #video-frame {
      width: 50%;
      aspect-ratio: 1.4;
      margin: 40px auto 15px auto;
      border: 2px solid cyan;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0,255,255,0.4), 0 0 25px rgba(200,0,255,0.3);
      position: relative;
      overflow: hidden;
      background: rgba(0, 0, 0, 0.4);
    }

    #video-stream {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: none;
    }

    #waiting-overlay {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: #00ffff;
      text-align: center;
    }

    #waiting-overlay h1 {
      font-size: 4rem;
      margin: 0;
      text-shadow: 0 0 10px cyan, 0 0 20px purple;
    }

    #waiting-overlay p {
      font-size: 1rem;
      margin-top: 5px;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 10px;
    }

    button {
      background: linear-gradient(135deg, #00e6e6, #6a0dad);
      color: white;
      border: none;
      padding: 12px 28px;
      font-size: 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: transform 0.2s;
    }

    button:hover { transform: scale(1.05); }

    /* Small buttons (overlay controls) */
    .small-btn {
      font-size: 12px;
      padding: 6px 10px;
      border-radius: 4px;
      margin-top: 5px;
      width: 100%;
    }

    /* Settings Button */
    #settings-btn {
      position: absolute;
      top: 20px;
      right: 30px;
      font-size: 16px;
      padding: 8px 18px;
      border-radius: 5px;
    }

    /* Settings Menu */
    #settings-menu {
      display: none;
      position: absolute;
      top: 60px;
      right: 30px;
      width: 250px;
      background: rgba(15, 15, 20, 0.95);
      border: 1px solid cyan;
      border-radius: 8px;
      box-shadow: 0 0 15px rgba(0,255,255,0.3);
      padding: 15px;
      z-index: 10;
    }

    #settings-menu h3 {
      text-align: center;
      color: cyan;
      margin-bottom: 10px;
    }

    .slider-container {
      margin: 12px 0;
    }

    .slider-container label {
      display: block;
      font-size: 14px;
      margin-bottom: 5px;
      color: #b0ffff;
    }

    input[type="range"], select {
      width: 100%;
      accent-color: cyan;
      background: none;
      color: white;
    }

    select {
      padding: 4px;
      border-radius: 5px;
      border: 1px solid cyan;
      background-color: rgba(0,0,0,0.4);
      color: white;
    }

    .note {
      font-size: 12px;
      opacity: 0.7;
      text-align: center;
      margin-top: 10px;
    }

    @media (max-width: 768px) {
      #video-frame { width: 85%; aspect-ratio: 1.2; }
    }

  </style>
</head>
<body>

  <!-- Background Video -->
  <video id="bg-video" autoplay muted loop playsinline preload="auto" poster="G.jpg">
    <source src="MainPage_small.mp4" type="video/mp4">
  </video>

  <!-- Overlay Video -->
  <video id="overlay-video" autoplay loop muted playsinline>
    <source src="whiteW.webm" type="video/webm">
  </video>

  <!-- LANDING PAGE -->
  <div id="landing">
    <img id="logo" src="Gta1.png" alt="GTA IRL Logo">
    <h3 class="glow-text">Created by Priyanshu</h3>
    <button id="start-btn">Start Game</button>
  </div>

  <!-- MAIN PAGE -->
  <div id="main-page">
    <button id="settings-btn">Settings</button>

    <div id="settings-menu">
      <h3>Settings</h3>

      <div class="slider-container">
        <label for="led-brightness">LED Brightness</label>
        <input type="range" id="led-brightness" min="0" max="255" value="0">
      </div>

      <div class="slider-container">
        <label for="resolution">Resolution</label>
        <select id="resolution">
          <option value="8">UXGA (1600x1200)</option>
          <option value="7">SXGA (1280x1024)</option>
          <option value="6">XGA (1024x768)</option>
          <option value="5" selected>VGA (640x480)</option>
          <option value="4">CIF (400x296)</option>
        </select>
      </div>

      <!-- ✅ Overlay Controls -->
      <div class="slider-container">
        <button id="pause-overlay" class="small-btn">Pause Wall E</button>
        <button id="hide-overlay" class="small-btn">Hide Wall E</button>
      </div>

      <p class="note">Pan/Tilt controls coming soon 🚧</p>
    </div>

    <div id="video-frame">
      <div id="waiting-overlay">
        <h1>Start Streaming</h1>
        <p>Waiting for stream to begin...</p>
      </div>
      <img id="video-stream" src="" alt="Camera Stream">
    </div>

    <div class="controls">
      <button id="start-stream">Start Stream</button>
      <button id="capture-btn">Capture Img</button>
    </div>
  </div>

  <!-- ✅ Updated SCRIPT -->
<script>
  const startGameBtn = document.getElementById('start-btn');
  const landing = document.getElementById('landing');
  const mainPage = document.getElementById('main-page');
  const overlay = document.getElementById('overlay-video');
  const settingsBtn = document.getElementById('settings-btn');
  const settingsMenu = document.getElementById('settings-menu');
  const pauseOverlayBtn = document.getElementById('pause-overlay');
  const hideOverlayBtn = document.getElementById('hide-overlay');

  // Transition to main page
  startGameBtn.addEventListener('click', () => {
    landing.classList.add('fade-out');
    setTimeout(() => {
      landing.style.display = 'none';
      mainPage.style.display = 'flex';
    }, 1000);
  });

  // === Main Page Functionality ===
  const video = document.getElementById('video-stream');
  const waitingOverlay = document.getElementById('waiting-overlay');
  const startStreamBtn = document.getElementById('start-stream');
  const captureBtn = document.getElementById('capture-btn');
  const ledSlider = document.getElementById('led-brightness');
  const resolutionSelect = document.getElementById('resolution');
  let streaming = false;
  let overlayPaused = false;
  let overlayHidden = false;

  startStreamBtn.addEventListener('click', () => {
    if (!streaming) {
      video.src = `/stream`;
      waitingOverlay.style.display = "none";
      video.style.display = "block";
      startStreamBtn.innerText = "Stop Stream";
    } else {
      video.src = "";
      video.style.display = "none";
      waitingOverlay.style.display = "flex";
      startStreamBtn.innerText = "Start Stream";
    }
    streaming = !streaming;
  });

  captureBtn.addEventListener('click', () => {
    fetch(`/capture`)
      .then(res => res.blob())
      .then(blob => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'capture.jpg';
        a.click();
      });
  });

  ledSlider.addEventListener('input', () => {
    fetch(`/control?var=led_intensity&val=${ledSlider.value}`);
  });

  resolutionSelect.addEventListener('change', () => {
    fetch(`/control?var=framesize&val=${resolutionSelect.value}`);
  });

  settingsBtn.addEventListener('click', () => {
    settingsMenu.style.display = settingsMenu.style.display === "block" ? "none" : "block";
  });

  // 🖱️ Close settings if clicked outside
  document.addEventListener('click', (event) => {
    const isInside = settingsMenu.contains(event.target) || settingsBtn.contains(event.target);
    if (!isInside && settingsMenu.style.display === "block") {
      settingsMenu.style.display = "none";
    }
  });

  // 🎬 Pause/Unpause overlay
  pauseOverlayBtn.addEventListener('click', () => {
    if (overlayPaused) {
      overlay.play();
      pauseOverlayBtn.innerText = "Pause Wall E";
    } else {
      overlay.pause();
      pauseOverlayBtn.innerText = "UnPause Wall E";
    }
    overlayPaused = !overlayPaused;
  });

  // 👁️ Hide/Unhide overlay
  hideOverlayBtn.addEventListener('click', () => {
    overlayHidden = !overlayHidden;
    overlay.style.display = overlayHidden ? "none" : "block";
    hideOverlayBtn.innerText = overlayHidden ? "Unhide Wall E" : "Hide Wall E";
  });

  // Keyboard Controls
  document.addEventListener('keydown', (e) => {
    if (["w", "a", "s", "d", "f"].includes(e.key.toLowerCase())) {
      fetch(`/control?var=command&val=${e.key.toLowerCase()}`);
    }
  });
</script>

</body>
</html>
